# [John Hull教材笔记]期权定价入门[1]: 一阶Binomia模型 - 无套利定价

虽然我不是数学或者金融专业的, 但既然在这个领域工作了, 就开始系统性地学习一下.

这篇文章按我自己的理解整理了John C. Hull的《Options, Futures, and Other Derivatives》相应的章节, 有删减, 也有增加背景介绍, 细节以原文为主, 有问题欢迎指出. 

防杠精声明: 如果觉得文章有错漏麻烦指出具体错在哪, 或给出正确的答案解释, 或者相应的引用来源.


## 期权是什么?

期权是一种金融产品, 是一个和客户(比如对冲基金)的合约, 合约的内容规定在某个时刻或者这个时刻之前, 客户有权利选择是否以某个价钱买入期权对应的证券. 

拿股票举例, 某个股票本身是有价格并且随着时间变动, 我们衍生出对应的股票期权, 规定在某个时刻或者这个时刻之前, 客户有权利选择是否以某个价钱买入这个股票. 

我们把这个例子里的股票称为标的证券(underlying security). 

我们把对应的期权称为衍生证券/衍生品(derivatives). 

## 为什么要做期权定价?

假如一个股票当前价值是$20, 这时候某个对冲基金觉得股票3个月后会涨到$22. 但是他们买1个股票本身要花费$20的成本, 还要持有3个月才能赚$2(10%).

这时候投行可以创造出1个对应的期权并且卖给这个基金客户, 这个期权规定, 在三个月到期后, 不管股票当时价格是多少, 客户都有权利以$21买入一定数量的这个股票. 

再假设这个期权的价格是$0.5(真的随便假设的), 我们也不考虑无风险利率, 并且3个月到期时股票涨跌只有2种情况:

1. 股票涨到了$22, 客户行使权利, 以$21的价格买入股票, 那么客户赚了$1, 相对于假设的期权价赚了1/(1-0.5)=100%. 虽然赚的绝对数值不高($0.5<$2), 但是不需要花费$20成本买股票并且持有3个月. 

2. 股票跌到了$18, 客户行使权利, 以$21的价格买入股票, 那么客户亏了$3...但客户必然不行使权利, 那么亏了当初买的期权价$0.5, 也就是亏了100%. 亏了的绝对数值也不高($0.5<$2), 同样不需要花费$20成本买股票并且持有3个月.

对于这个对冲基金来说, 这个期权真的非常值得买, 但对于投行来说, 这个期权卖这个价合理吗? 

投行要考虑, 这个期权要卖多少钱, 才能在最倒霉的情况下不亏呢? 

客户也要考虑, 要花多少钱买入这个期权, 在最好的情况下赚最多, 在最倒霉的情况下, 合理地亏掉一些呢? 

这个问题也就是所谓的期权定价(options pricing). 

```
背景知识:
股票本身的价格是$20, 这是标的价格(Underlying price)
这种期权只能在到期日执行, 不能提前执行, 这种合约称之为欧式期权(European option)
因为投行卖出期权的合约是用户有权利买入股票(也可以不买), 这种合约我们称之为看涨期权(call option), 因为客户看涨才买嘛
这个合约规定的行使权利的价格是$21, 这也就是行权价(strike price)
```

## Binomial Tree定价

Binomial Tree是一个很常用的定价模型. 在这种模型下, 我们有一系列假设. 

其中的基本假设是, 股票价格是随机游走的(random walk). 从一个时间段的开头到结尾, 股票价格可能上涨, 也可能下跌, 但都是完全随机的.

接下来看个案例, 我们再加一个假设就可以做出定价了. 

### 一阶Binomia模型 - 案例

我们再看这个案例, 取一个时间段3个月. 假设某个股票当前价格(underlying price)是$20. 

假设3个月后股票价格有2种可能, 股票可能涨到$22, 也可能跌到$18. 

注意这里没有给出涨跌概率, 只给出了涨跌可能的结果. 不管它是50%的概率涨还是90%的概率涨, 我们只把股价涨跌后的可能的结果拿来做期权定价, 实际上涨跌的概率已经包含在股价里面了(The probabilities of future up or down movements are already incoperated into the stock price).

1. 股票涨到了$22, 如果客户行使权利, 以$21的价格买入股票, 那么客户赚了$1, 这时候这个期权的价值就是$1

2. 股票跌到了$18, 客户必然不行使权利, 这时候这个期权的价值就是$0

![image](https://user-images.githubusercontent.com/5571030/206761957-1ab76bb4-23fb-4e95-84a0-ebbf8218d267.png)

这时候你作为投行, 你要决定这个期权最开始以多少价格出售, 你会怎么做呢?

### 一阶Binomia模型: 无套利定价(No-arbitrage pricing)案例

我们做一个假设, 市场上没有套利的机会(arbitrage opportunities do not exist).

也就是说我们是在一个有效市场里的(efficient market), 其中市场上的价格就是产品真实的价值, 不会因为流动性不够等原因导致市场上的价格和真实价值不一样. 即使某个时刻市场上可能出现短暂的价格和价值不符, 也就是短暂的套利机会, 我们也假设马上就会有人用掉了这个机会从而让产品的价格反应出它真实的价值. 

因为市场上没有套利的机会, 所以我们可以通过购买一定量的股票本身来完美复制出和期权一样的现金流. 接着我们看看到底要买多少股票.

假设我们购买 $&Delta;$ 个股票, 我们当前拥有的股票资产价值是 $20&Delta;$

三个月后的两种可能:

1. 股票涨到了$22, 股票价值 $22&Delta;$, 期权价值$1

2. 股票跌到了$18, 股票资产价值是 $18&Delta;$, 期权价值$0

这两种情况期权价差是 1 - 0, 我们让我们购买的 $&Delta;$ 个股票也体现出同样的价差:

$$22&Delta; - 18&Delta; = 1 - 0$$

算出 $&Delta; = 0.25$ 

也就是说, 我们最初可以购买价值 $20 \times 0.25 = 5$ 的股票, 可能涨到 $22 \times 0.25 = 5.5$, 也可能跌到 $18 \times 0.25 = 4.5$.

这个数量的股票, 在没有套利机会的情况下, 可以完美复制出期权一样的现金流. 也就是说我们通过这个数量的股票创造出了这个期权, 现在我们看看这个期权最初的价格可以定多少. 

#### 再次简化: 不考虑无风险利率(No interest free rate)

```
这里我们偏离一下教材, 再简化一点, 并且尝试更通俗地过一遍这个例子
```

我们暂时不考虑无风险利率, 也就是说我们现在借钱不需要付利息. 

那么最开始可以借$4.5, 自己掏 $5-4.5 = 0.5$ 买总价值$5的股票. 

3个月后如果股票跌到$4.5, 最后卖掉股票可以拿到$4.5全部还掉, 自己什么都没赚.  (这样股票跌了之后, 买股票本身的现金流完全和买期权一样)

如果股票涨到$5.5, 卖掉后还了当初借的$4.5, 赚了$1. (这样股票涨了之后, 买股票本身的现金流完全和买期权一样)

所以最开始自掏腰包的那 $5-4.5 = 0.5$ 就可以是期权价格. 

#### 复杂一些: 考虑无风险利率(interest free rate)

```
依旧偏离教材, 现在更复杂一点
```

我们把无风险利率考虑进来, 也就是借钱需要付利息, 假设年利息12%. 

那么最开始可以借 $X$ , 自己掏 $5-X$ 买总价值$5的股票. 

3个月后如果股票跌到$4.5, 最后卖掉股票得到的$4.5全部用来还本金和利息, 自己什么都没赚.  (股票跌了之后, 买股票本身的现金流完全和买期权一样)

如果股票涨到$5.5, 卖掉后还了当初借的本金和利息$4.5, 赚了$1. (这样股票涨了之后, 买股票本身的现金流完全和买期权一样)

那么我们可以算出最开始借的钱是:

$$X = 4.5e^{-0.12 \times 3/12} = 4.367$$

```
这里带e的计算是复利(continuous compounding). 无风险利率是12%, 资产本金4.367通过每日复利(daily compounding)3个月后就能得到4.5.
如果按复利算看不明白的话, 我们把它当年利率, 也可以算算看3个月前的资产价值: x*(1+0.12/4) = 4.5, x=4.369, 理解这个意思就行了.
```

所以最开始自掏腰包要多少钱呢? $5 - X = 5-4.367 = 0.633$ 就是期权价格. 

#### 无风险资产组合

现在我们从投行的角度看看, 如果投行想卖出1个期权, 在无套利机会的情况下, 通过购买 $&Delta;$ 个股票, 买入股票的现金流和卖出期权的现金流可以完全对冲掉, 这就创建出了一个无风险资产组合(riskless portfolio). (投行这样就完全赚不到钱了吗? 实际上在理想情况下, 投行是通过交易费/中介费/服务费盈利的)

我们来看看这个资产组合:

1. 投行买入这个股票本身, 买入的股票数量是 $&Delta;$, 投行拥有的股票资产价值是 $20&Delta;$

2. 同时投行卖出1个行权价(strike price)是$21的看涨期权(call option), 假设这个期权的价格是 $f$, 投行拥有的期权资产价值是 $-f$

这时候投行拥有的总资产价值是: 

$$20&Delta; - f$$

补充说明: 这个意思也就是投行创建出这样的资产组合的开销, 要花费 $20&Delta;$ 买股票, 但是卖出期权收入了 $f$ , 也就是花费 $-f$ . 

我们接下来要: 

1. 算算 $&Delta;$ 应该是多少, 才能让这个资产组合在无套利机会的情况下无风险, 也就是最终价值不会受股票价格变动而变动?

2. 算出这时候这个期权要卖多少钱, 也就是 $f$ 是多少?

再回看两种情况:

股票涨到$22:

1. 因为这时股票价值$22, 所以投行拥有的股票资产价值是 $22&Delta;$

2. 因为这时的期权价值$1, 所以投行拥有的期权资产价值是 $-1$

这时候投行拥有的总资产价值是: 

$$22&Delta; - 1$$

股票跌到$18:

1. 因为这时股票价值$18, 所以投行拥有的股票资产价值是 $18&Delta;$

2. 因为这时的期权价值$0, 所以投行拥有的期权资产价值是 $-0$

这时候投行拥有的总资产价值是: 

$$18&Delta; - 0$$

投行拥有的这个资产组合在任何情况下都不会有风险, 所以这两种情况发生后, 总资产价值应该一样: 

$$22&Delta; - 1 = 18&Delta; - 0$$

算出来: $&Delta; = 0.25$

股票涨到$22, 这个资产组合价值: $22 \times 0.25 - 1 = 4.5$

股票跌到$18, 这个资产组合价值: $18 \times 0.25 - 0 = 4.5$

所以不管怎么样这个资产组合的价值都是$4.5. 这也对应上我们之前例子里, 如果一开始借钱建立了这样的资产组合, 到期后我们需要还$4.5

3个月前呢? 同样我们假设现在每年的无风险利率(risk free rate)是12%, 现在的资产组合价值是4.5, 那么3个月前的资产价值就是:

$$4.5e^{-0.12 \times 3/12} = 4.367$$

总之, 我们算出了投行最开始拥有的资产价值(也就是最开始可以借钱购买的资产价值): 

$$20&Delta; - f = 4.367$$

我们也算出 $&Delta;=0.25$, 那么我们就知道了最开始期权该卖多少钱了:
$$20 \times 0.25 - f = 4.367$$
$$f = 0.633$$


### 一阶Binomia模型: 无套利定价(No-arbitrage pricing)公式

我们最后把上面的例子整理成一般化的公式:

假设某个股票当前价格(underlying price)是 $S_0$, 这时候投行为了建立无风险资产组合买入的股票价格是 $S_0&Delta;$, 卖出的股票期权价格是 $f$, 是我们要算出的值.

这时候投行拥有的总资产价值是: 

$$S_0&Delta; - f$$

如下图, 我们把之前的例子一般化:

![image](https://user-images.githubusercontent.com/5571030/207022685-b1135476-b384-4bfd-9a77-7122830a793d.png)

一段时间 $T$ 后, 有两种情况:

1. 股票上涨到 $S_0 \times u , u>1$ , 这时的期权价值是 $f_u$, 这时候总资产价值 $S_0 \times u \times &Delta; - f_u$
2. 股票下跌到 $S_0 \times d , d<1$ , 这时的期权价值是 $f_d$, 这时候总资产价值 $S_0 \times d \times &Delta; - f_d$

这两种情况发生后, 总资产价值应该一样: 
$$S_0 \times u \times &Delta; - f_u = S_0 \times d \times &Delta; - f_d$$

整理一下:
$$&Delta; =  \frac{f_u - f_d}  { S_0 \times u - S_0 \times d }$$

假设无风险利率是 $r$, 因为上涨或者下跌后资产组合的价值都一样, 我们取上涨后的资产组合价值, 折现到时间段 $T$ 之前的资产组合的价值(Present Value):

$$(S_0 \times u \times &Delta; - f_u)e^{-rT}$$

折现后资产组合的价值和我们最开始得出的价值应该一样：

$$S_0&Delta; - f = (S_0 \times u \times &Delta; - f_u)e^{-rT}$$

得出:

$$f = S_0&Delta; -  (S_0 \times u \times &Delta; - f_u)e^{-rT} $$

$$f = S_0&Delta;(1-ue^{-rT}) +  f_ue^{-rT}$$

把之前的 $&Delta;$ 带入:

$$f = S_0 (\frac{f_u - f_d}  { S_0 \times u - S_0 \times d }) (1-ue^{-rT}) +  f_ue^{-rT}$$

就可以把 $S_0$ 抵消了:

$$f = (\frac{f_u - f_d}  { u -  d }) (1-ue^{-rT}) +  f_ue^{-rT}$$

再整理一下:

$$f = \frac{(f_u - f_d)(1-ue^{-rT}) + f_ue^{-rT}(u-d)}  { u -  d }$$

$$f = \frac{ f_u - f_d - f_u ue^{-rT} + f_d ue^{-rT} + f_u ue^{-rT} - f_u de^{-rT}}  { u -  d }$$


$$f = \frac{ f_u - f_d + f_d ue^{-rT}  - f_u de^{-rT}}  { u -  d }$$

$$f = \frac{ e^{-rT}(f_u e^{rT} - f_d e^{rT} + f_d u  - f_u d ) }  { u -  d }$$

$$f = \frac{ e^{-rT}[f_u (e^{rT} - d) + f_d (u - e^{rT} ) ] }  { u -  d }$$

$$f = \frac{ e^{-rT}[f_u (e^{rT} - d) + f_d (u - d - e^{rT} + d) ] }  { u -  d }$$

$$f =  e^{-rT}[p f_u  + (1-p) f_d ] \text{ ,  }  p = \frac{(e^{rT} - d)} {u-d}$$

我们抽出一个 $p$ 留着以后来看. 

把之前例子里的具体数字拿来:

最初股票价格: $S_0 = 20$

股票涨到$22: $S_0 u = 22, u = 1.1$ , 期权价值: $f_u = 1$

股票跌到$18: $S_0 d = 18, d = 0.91$ , 期权价值: $f_d = 0$

无风险利率: $r = 0.12$

时间是3个月, 以一年为单位: $T = 3/12 = 0.25$

代入公式:

$$p = \frac{e^{0.12 \times 3/12} - 0.9} {1.1 - 0.9} = 0.6523$$

$$f = e^{-0.12 \times 3/12} (0.6523 \times 1 + 0.3477 \times 0) = 0.633 $$

我们发现这和我们之前例子算出来的值是一样的, 验证出我们抽象出来的公式没有问题. 
